 TestPostHttp;cfg;webservice;meter;counter;mtr
 :If 0<≢2 ⎕NQ'.' 'GetEnvironment' 'GITHUB_TOKEN'
    Skip'PostHttp not available on Github'
 :EndIf
 ##.Reset
 cfg←##.Notela.NewConfiguration'Tests' '1.0.0'
 cfg.ExportInterval←0
 cfg.BatchSize←1
 cfg.OtelHttpUrlMetrics←'http://localhost:4318/send'
 ##.Notela.Start cfg
 meter←##.Notela.GetMeter'TestMeter' '0.1.0'
 counter←meter.CreateCounter'aplerrors'
 counter.Record 15 'exception.type' 11

 webservice←⎕NEW #.Notela.Jarvis(4318 ## 'JSON')
 webservice.Start
 counter.Record 15 'exception.type' 11

 mtr←##.GetTrace 0.1
 Assert∧/'exception'∊mtr
 webservice.Stop
⍝
